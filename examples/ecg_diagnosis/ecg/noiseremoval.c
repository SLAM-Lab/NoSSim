#include <stdio.h>
#include <stdlib.h>
#include "noiseremoval.h"

double *noiseremoval(double *sig, int _N) {

    int i,n;
    int D_h = 330;
    int D_l = 91;
    double Num_high[661] = {-0.000186, -0.000021, -0.000022, -0.000024, -0.000025, -0.000026, -0.000027, -0.000029, -0.000030, -0.000032, -0.000033, -0.000035, -0.000037, -0.000038, -0.000040, -0.000042, -0.000044, -0.000046, -0.000047, -0.000049, -0.000052, -0.000054, -0.000056, -0.000058, -0.000060, -0.000063, -0.000065, -0.000068, -0.000070, -0.000073, -0.000075, -0.000078, -0.000081, -0.000084, -0.000087, -0.000090, -0.000093, -0.000096, -0.000099, -0.000103, -0.000106, -0.000109, -0.000113, -0.000116, -0.000120, -0.000124, -0.000128, -0.000132, -0.000136, -0.000140, -0.000144, -0.000148, -0.000152, -0.000157, -0.000161, -0.000166, -0.000171, -0.000175, -0.000180, -0.000185, -0.000190, -0.000195, -0.000200, -0.000206, -0.000211, -0.000217, -0.000222, -0.000228, -0.000234, -0.000240, -0.000246, -0.000252, -0.000258, -0.000264, -0.000271, -0.000277, -0.000284, -0.000291, -0.000297, -0.000304, -0.000311, -0.000319, -0.000326, -0.000333, -0.000341, -0.000348, -0.000356, -0.000364, -0.000372, -0.000380, -0.000388, -0.000396, -0.000404, -0.000413, -0.000421, -0.000430, -0.000439, -0.000448, -0.000457, -0.000466, -0.000475, -0.000484, -0.000494, -0.000504, -0.000513, -0.000523, -0.000533, -0.000543, -0.000553, -0.000564, -0.000574, -0.000584, -0.000595, -0.000606, -0.000617, -0.000628, -0.000639, -0.000650, -0.000661, -0.000673, -0.000684, -0.000696, -0.000708, -0.000720, -0.000732, -0.000744, -0.000756, -0.000768, -0.000781, -0.000793, -0.000806, -0.000819, -0.000832, -0.000845, -0.000858, -0.000871, -0.000884, -0.000898, -0.000911, -0.000925, -0.000939, -0.000952, -0.000966, -0.000980, -0.000994, -0.001009, -0.001023, -0.001038, -0.001052, -0.001067, -0.001081, -0.001096, -0.001111, -0.001126, -0.001141, -0.001156, -0.001172, -0.001187, -0.001202, -0.001218, -0.001234, -0.001249, -0.001265, -0.001281, -0.001297, -0.001313, -0.001329, -0.001345, -0.001361, -0.001377, -0.001394, -0.001410, -0.001427, -0.001443, -0.001460, -0.001476, -0.001493, -0.001510, -0.001527, -0.001544, -0.001560, -0.001577, -0.001594, -0.001611, -0.001629, -0.001646, -0.001663, -0.001680, -0.001697, -0.001715, -0.001732, -0.001749, -0.001767, -0.001784, -0.001801, -0.001819, -0.001836, -0.001854, -0.001871, -0.001889, -0.001906, -0.001924, -0.001941, -0.001959, -0.001976, -0.001994, -0.002011, -0.002029, -0.002046, -0.002064, -0.002081, -0.002099, -0.002116, -0.002133, -0.002151, -0.002168, -0.002186, -0.002203, -0.002220, -0.002237, -0.002255, -0.002272, -0.002289, -0.002306, -0.002323, -0.002340, -0.002357, -0.002374, -0.002390, -0.002407, -0.002424, -0.002440, -0.002457, -0.002473, -0.002490, -0.002506, -0.002522, -0.002538, -0.002554, -0.002570, -0.002586, -0.002602, -0.002618, -0.002634, -0.002649, -0.002664, -0.002680, -0.002695, -0.002710, -0.002725, -0.002740, -0.002755, -0.002769, -0.002784, -0.002798, -0.002813, -0.002827, -0.002841, -0.002855, -0.002869, -0.002882, -0.002896, -0.002909, -0.002922, -0.002935, -0.002948, -0.002961, -0.002974, -0.002986, -0.002998, -0.003011, -0.003023, -0.003035, -0.003046, -0.003058, -0.003069, -0.003080, -0.003091, -0.003102, -0.003113, -0.003123, -0.003134, -0.003144, -0.003154, -0.003163, -0.003173, -0.003182, -0.003192, -0.003201, -0.003210, -0.003218, -0.003227, -0.003235, -0.003243, -0.003251, -0.003259, -0.003266, -0.003273, -0.003280, -0.003287, -0.003294, -0.003300, -0.003307, -0.003313, -0.003318, -0.003324, -0.003329, -0.003335, -0.003339, -0.003344, -0.003349, -0.003353, -0.003357, -0.003361, -0.003365, -0.003368, -0.003371, -0.003374, -0.003377, -0.003380, -0.003382, -0.003384, -0.003386, -0.003388, -0.003389, -0.003391, -0.003392, -0.003392, -0.003393, -0.003393, 0.996607, -0.003393, -0.003393, -0.003392, -0.003392, -0.003391, -0.003389, -0.003388, -0.003386, -0.003384, -0.003382, -0.003380, -0.003377, -0.003374, -0.003371, -0.003368, -0.003365, -0.003361, -0.003357, -0.003353, -0.003349, -0.003344, -0.003339, -0.003335, -0.003329, -0.003324, -0.003318, -0.003313, -0.003307, -0.003300, -0.003294, -0.003287, -0.003280, -0.003273, -0.003266, -0.003259, -0.003251, -0.003243, -0.003235, -0.003227, -0.003218, -0.003210, -0.003201, -0.003192, -0.003182, -0.003173, -0.003163, -0.003154, -0.003144, -0.003134, -0.003123, -0.003113, -0.003102, -0.003091, -0.003080, -0.003069, -0.003058, -0.003046, -0.003035, -0.003023, -0.003011, -0.002998, -0.002986, -0.002974, -0.002961, -0.002948, -0.002935, -0.002922, -0.002909, -0.002896, -0.002882, -0.002869, -0.002855, -0.002841, -0.002827, -0.002813, -0.002798, -0.002784, -0.002769, -0.002755, -0.002740, -0.002725, -0.002710, -0.002695, -0.002680, -0.002664, -0.002649, -0.002634, -0.002618, -0.002602, -0.002586, -0.002570, -0.002554, -0.002538, -0.002522, -0.002506, -0.002490, -0.002473, -0.002457, -0.002440, -0.002424, -0.002407, -0.002390, -0.002374, -0.002357, -0.002340, -0.002323, -0.002306, -0.002289, -0.002272, -0.002255, -0.002237, -0.002220, -0.002203, -0.002186, -0.002168, -0.002151, -0.002133, -0.002116, -0.002099, -0.002081, -0.002064, -0.002046, -0.002029, -0.002011, -0.001994, -0.001976, -0.001959, -0.001941, -0.001924, -0.001906, -0.001889, -0.001871, -0.001854, -0.001836, -0.001819, -0.001801, -0.001784, -0.001767, -0.001749, -0.001732, -0.001715, -0.001697, -0.001680, -0.001663, -0.001646, -0.001629, -0.001611, -0.001594, -0.001577, -0.001560, -0.001544, -0.001527, -0.001510, -0.001493, -0.001476, -0.001460, -0.001443, -0.001427, -0.001410, -0.001394, -0.001377, -0.001361, -0.001345, -0.001329, -0.001313, -0.001297, -0.001281, -0.001265, -0.001249, -0.001234, -0.001218, -0.001202, -0.001187, -0.001172, -0.001156, -0.001141, -0.001126, -0.001111, -0.001096, -0.001081, -0.001067, -0.001052, -0.001038, -0.001023, -0.001009, -0.000994, -0.000980, -0.000966, -0.000952, -0.000939, -0.000925, -0.000911, -0.000898, -0.000884, -0.000871, -0.000858, -0.000845, -0.000832, -0.000819, -0.000806, -0.000793, -0.000781, -0.000768, -0.000756, -0.000744, -0.000732, -0.000720, -0.000708, -0.000696, -0.000684, -0.000673, -0.000661, -0.000650, -0.000639, -0.000628, -0.000617, -0.000606, -0.000595, -0.000584, -0.000574, -0.000564, -0.000553, -0.000543, -0.000533, -0.000523, -0.000513, -0.000504, -0.000494, -0.000484, -0.000475, -0.000466, -0.000457, -0.000448, -0.000439, -0.000430, -0.000421, -0.000413, -0.000404, -0.000396, -0.000388, -0.000380, -0.000372, -0.000364, -0.000356, -0.000348, -0.000341, -0.000333, -0.000326, -0.000319, -0.000311, -0.000304, -0.000297, -0.000291, -0.000284, -0.000277, -0.000271, -0.000264, -0.000258, -0.000252, -0.000246, -0.000240, -0.000234, -0.000228, -0.000222, -0.000217, -0.000211, -0.000206, -0.000200, -0.000195, -0.000190, -0.000185, -0.000180, -0.000175, -0.000171, -0.000166, -0.000161, -0.000157, -0.000152, -0.000148, -0.000144, -0.000140, -0.000136, -0.000132, -0.000128, -0.000124, -0.000120, -0.000116, -0.000113, -0.000109, -0.000106, -0.000103, -0.000099, -0.000096, -0.000093, -0.000090, -0.000087, -0.000084, -0.000081, -0.000078, -0.000075, -0.000073, -0.000070, -0.000068, -0.000065, -0.000063, -0.000060, -0.000058, -0.000056, -0.000054, -0.000052, -0.000049, -0.000047, -0.000046, -0.000044, -0.000042, -0.000040, -0.000038, -0.000037, -0.000035, -0.000033, -0.000032, -0.000030, -0.000029, -0.000027, -0.000026, -0.000025, -0.000024, -0.000022, -0.000021, -0.000186};
    int hlen = 661;
    double Num_low[183] = {0.000220, 0.000580, 0.001199, 0.002057, 0.003064, 0.004039, 0.004736, 0.004906, 0.004369, 0.003091, 0.001230, -0.000873, -0.002771, -0.004021, -0.004324, -0.003634, -0.002187, -0.000455, 0.000996, 0.001688, 0.001391, 0.000217, -0.001410, -0.002888, -0.003654, -0.003390, -0.002154, -0.000378, 0.001280, 0.002174, 0.001923, 0.000571, -0.001402, -0.003245, -0.004210, -0.003854, -0.002229, 0.000103, 0.002260, 0.003370, 0.002923, 0.000994, -0.001739, -0.004229, -0.005449, -0.004811, -0.002434, 0.000856, 0.003802, 0.005190, 0.004345, 0.001442, -0.002498, -0.005955, -0.007486, -0.006312, -0.002689, 0.002116, 0.006248, 0.007973, 0.006386, 0.001847, -0.004052, -0.009025, -0.010952, -0.008757, -0.002936, 0.004490, 0.010644, 0.012868, 0.009822, 0.002167, -0.007485, -0.015398, -0.018080, -0.013720, -0.003126, 0.010240, 0.021267, 0.024964, 0.018440, 0.002373, -0.018608, -0.036909, -0.044107, -0.033650, -0.003231, 0.043933, 0.099453, 0.151723, 0.188960, 0.202443, 0.188960, 0.151723, 0.099453, 0.043933, -0.003231, -0.033650, -0.044107, -0.036909, -0.018608, 0.002373, 0.018440, 0.024964, 0.021267, 0.010240, -0.003126, -0.013720, -0.018080, -0.015398, -0.007485, 0.002167, 0.009822, 0.012868, 0.010644, 0.004490, -0.002936, -0.008757, -0.010952, -0.009025, -0.004052, 0.001847, 0.006386, 0.007973, 0.006248, 0.002116, -0.002689, -0.006312, -0.007486, -0.005955, -0.002498, 0.001442, 0.004345, 0.005190, 0.003802, 0.000856, -0.002434, -0.004811, -0.005449, -0.004229, -0.001739, 0.000994, 0.002923, 0.003370, 0.002260, 0.000103, -0.002229, -0.003854, -0.004210, -0.003245, -0.001402, 0.000571, 0.001923, 0.002174, 0.001280, -0.000378, -0.002154, -0.003390, -0.003654, -0.002888, -0.001410, 0.000217, 0.001391, 0.001688, 0.000996, -0.000455, -0.002187, -0.003634, -0.004324, -0.004021, -0.002771, -0.000873, 0.001230, 0.003091, 0.004369, 0.004906, 0.004736, 0.004039, 0.003064, 0.002057, 0.001199, 0.000580, 0.000220};
    int llen = 183;
   
    double *ext_sig_high =(double *) malloc((_N+D_h)*sizeof(double));
    double *ext_sig_low = (double *) malloc((_N+D_l)*sizeof(double));
    double *y_high_ext = (double *) malloc((_N+D_h)*sizeof(double));
    double *y_low_ext = (double *) malloc((_N+D_l)*sizeof(double));
    double *y_high = (double *) malloc((_N)*sizeof(double));
    double *sig_filt = (double *) malloc((_N)*sizeof(double));

    for (i=0; i<_N; i++){
        ext_sig_high[i] = sig[i];
    }
    for (i=_N; i<_N+D_h; i++){
        ext_sig_high[i] = 0;
    } 
    for (n=0; n<(_N+D_h); n++){
        y_high_ext[n]=0;
        for (i=0; i<hlen; i++){
            if ((n-i)>=0) {
                y_high_ext[n]=y_high_ext[n]+Num_high[i]*ext_sig_high[n-i];
            }
        }//printf("%f\n",y_high_ext[n]);
    }
    for (i=D_h; i<(D_h+_N); i++) {
        y_high[i-D_h] = y_high_ext[i];
    }
    
    for (i=0; i<_N; i++){
        ext_sig_low[i] = y_high[i];
    }
    for (i=_N; i<_N+D_l; i++){
        ext_sig_low[i] = 0;
    } 
    for (n=0; n<(_N+D_l); n++){
        y_low_ext[n]=0;
        for (i=0; i<llen; i++){
            if ((n-i)>=0) {
                y_low_ext[n]=y_low_ext[n]+Num_low[i]*ext_sig_low[n-i];
            }
        }
    }

    for (i=D_l; i<(D_l+_N); i++) {
        sig_filt[i-D_l] = y_low_ext[i]; 
    }

	free(ext_sig_high);
	free(ext_sig_low);
	free(y_high_ext);
	free(y_low_ext);
	free(y_high);

    return(sig_filt);
}
